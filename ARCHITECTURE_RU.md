# ๐๏ธ ะััะธัะตะบัััะฐ ESP32-S3 FPV Drone Camera System

## ๐ ะะฑัะธะน ะพะฑะทะพั

ะัะพะตะบั ะฟะพัััะพะตะฝ ะฝะฐ ะผะพะดัะปัะฝะพะน ะฐััะธัะตะบัััะต ั ัะตัะบะธะผ ัะฐะทะดะตะปะตะฝะธะตะผ ะพัะฒะตัััะฒะตะฝะฝะพััะธ ะผะตะถะดั ะบะพะผะฟะพะฝะตะฝัะฐะผะธ. ะะฐะถะดัะน ะผะพะดัะปั ะธะฝะบะฐะฟััะปะธััะตั ัะฒะพั ััะฝะบัะธะพะฝะฐะปัะฝะพััั ะธ ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั ะดััะณะธะผะธ ัะตัะตะท ะพะฟัะตะดะตะปะตะฝะฝัะต ะธะฝัะตััะตะนัั.

## ๐ฏ ะะปััะตะฒัะต ะฟัะธะฝัะธะฟั ะฐััะธัะตะบัััั

- โ **ะะพะดัะปัะฝะพััั**: ะะฐะถะดัะน ะบะพะผะฟะพะฝะตะฝั - ะพัะดะตะปัะฝัะน ะบะปะฐัั ั ััะฝะพะน ะพัะฒะตัััะฒะตะฝะฝะพัััั
- โ **ะะฐััะธััะตะผะพััั**: ะะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ััะฝะบัะธะธ ะธ ะผะพะดัะปะธ
- โ **ะัะบะฐะทะพัััะพะนัะธะฒะพััั**: ะกะธััะตะผะฐ ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัะฐัั ะฟัะธ ัะฑะพัั ะพัะดะตะปัะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ
- โ **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**: ะะฟัะธะผะธะทะฐัะธั ะดะปั ะดะฒััััะดะตัะฝะพะณะพ ESP32-S3
- โ **ะะธะฐะณะฝะพััะธะบะฐ**: ะะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะธ ะบะพะผะฐะฝะดั ะดะปั ะพัะปะฐะดะบะธ

## ๐งฉ ะกัััะบัััะฐ ะผะพะดัะปะตะน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    SystemManager                            โ
โ              (ะฆะตะฝััะฐะปัะฝัะน ะบะพะพัะดะธะฝะฐัะพั)                       โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโ
              โ             โ             โ             โ
    โโโโโโโโโโโผโโโโโโโ โโโโโโผโโโโโโ โโโโโโโผโโโโโโโ โโโโโผโโโโโโโโโ
    โ  WiFiModule    โ โOV2640Cameraโ โWebSocketSvrโ โTaskManager โ
    โ (ะขะพัะบะฐ ะดะพัััะฟะฐ)โ โ (ะัะฐะนะฒะตั)  โ โ (ะกััะธะผะธะฝะณ) โ โ(FreeRTOS)  โ
    โโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโ โโโโโโโโโโโโโโ โโโโโโโโโโโโโโ
              โ             โ             โ             โ
    โโโโโโโโโโโผโโโโโโโ โโโโโโผโโโโโโ โโโโโโโผโโโโโโโ โโโโโผโโโโโโโโโ
    โ   ESP32 WiFi   โ โ OV2640   โ โNative WS   โ โ  Core 0    โ
    โ   Hardware     โ โ Hardware โ โ Protocol   โ โ  Core 1    โ
    โโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโ โโโโโโโโโโโโโโ โโโโโโโโโโโโโโ
```

## ๐ ะะตัะฐะปัะฝะฐั ััััะบัััะฐ ะฟัะพะตะบัะฐ

### `/src/main.cpp` - ะขะพัะบะฐ ะฒัะพะดะฐ

```cpp
// ะะธะฝะธะผะฐะปะธััะธัะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ
void setup() {
    SystemManager::getInstance().init();  // ะะฝะธัะธะฐะปะธะทะฐัะธั ะฒัะตั ะผะพะดัะปะตะน
}

void loop() {
    SystemManager::getInstance().run();   // ะัะฝะพะฒะฝะพะน ัะธะบะป
}
```

### `/src/system/system_manager.cpp` - ะฆะตะฝััะฐะปัะฝัะน ะผะตะฝะตะดะถะตั

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะะฝะธัะธะฐะปะธะทะฐัะธั ะฒัะตั ะผะพะดัะปะตะน ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ะฟะพััะดะบะต
- ะะพะพัะดะธะฝะฐัะธั ัะฐะฑะพัั ะผะตะถะดั ะผะพะดัะปัะผะธ
- ะะพะฝะธัะพัะธะฝะณ ัะพััะพัะฝะธั ัะธััะตะผั
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะธ ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต

**ะะปััะตะฒัะต ะผะตัะพะดั:**

```cpp
bool initialize()     // ะะฝะธัะธะฐะปะธะทะฐัะธั ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ
void update()         // ะัะฝะพะฒะฝะพะน ัะธะบะป ะพะฑะฝะพะฒะปะตะฝะธั
void shutdown()       // ะะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต ัะฐะฑะพัั
void printSystemStatus() // ะกัะฐััั ะฒัะตั ะผะพะดัะปะตะน
```

### `/src/wifi/wifi_module.cpp` - WiFi ัะพัะบะฐ ะดะพัััะฟะฐ

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะกะพะทะดะฐะฝะธะต WiFi ัะพัะบะธ ะดะพัััะฟะฐ (AP ัะตะถะธะผ)
- ะะพะฝะธัะพัะธะฝะณ ะฟะพะดะบะปััะตะฝะธะน ะบะปะธะตะฝัะพะฒ
- ะะฑัะฐะฑะพัะบะฐ ัะพะฑััะธะน WiFi
- ะะธะฐะณะฝะพััะธะบะฐ ัะตัะตะฒัั ะฟัะพะฑะปะตะผ

**ะะฐัััะพะนะบะธ ะฟะพ ัะผะพะปัะฐะฝะธั:**

```cpp
SSID: "ESP32-S3_Drone_30fps"
Password: "drone2024"
IP: 192.168.4.1
Channel: Auto
Max Clients: 4
```

### `/src/camera/ov2640.cpp` - ะัะฐะนะฒะตั ะบะฐะผะตัั

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะะฝะธัะธะฐะปะธะทะฐัะธั ะบะฐะผะตัั OV2640/OV5640
- ะะฐัะฒะฐั ะบะฐะดัะพะฒ ะฒ JPEG ัะพัะผะฐัะต
- ะะฐัััะพะนะบะฐ ะบะฐัะตััะฒะฐ ะธ ัะฐะทัะตัะตะฝะธั
- ะกัะฐัะธััะธะบะฐ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

**ะะฟัะธะผะธะทะฐัะธะธ:**

```cpp
Target FPS: 30
JPEG Quality: 8 (ะพะฟัะธะผะฐะปัะฝัะน ะฑะฐะปะฐะฝั)
Frame Size: QVGA (320x240)
Buffer Count: 2 (ะดะฒะพะนะฝะฐั ะฑััะตัะธะทะฐัะธั)
XCLK Frequency: 24MHz
```

### `/src/ws/websocket_server.cpp` - WebSocket ัะตัะฒะตั

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะะฐัะธะฒะฝะฐั ัะตะฐะปะธะทะฐัะธั WebSocket ะฟัะพัะพะบะพะปะฐ (RFC 6455)
- ะะฑัะปัะถะธะฒะฐะฝะธะต ะดะพ 3 ะบะปะธะตะฝัะพะฒ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
- ะะธะฝะฐัะฝะฐั ะฟะตัะตะดะฐัะฐ JPEG ะบะฐะดัะพะฒ
- ะัััะพะตะฝะฝัะน HTML ะบะปะธะตะฝั ะดะปั ะฑัะฐัะทะตัะฐ

**ะัะพะฑะตะฝะฝะพััะธ:**

- ะััััััะฒะธะต ะฑะธะฑะปะธะพัะตัะฝะพะน ะทะฐะฒะธัะธะผะพััะธ ะพั WebSocket
- ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝะฐั ะฟะตัะตะดะฐัะฐ ะฑะตะท ะฑััะตัะธะทะฐัะธะธ
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะฟะตัะตะฟะพะดะบะปััะตะฝะธะต ะบะปะธะตะฝัะพะฒ
- Ping/Pong ะดะปั ะบะพะฝััะพะปั ัะพะตะดะธะฝะตะฝะธั

### `/src/tasks/task_manager.cpp` - ะะตะฝะตะดะถะตั ะทะฐะดะฐั FreeRTOS

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐั ะฝะฐ ัะฐะทะฝัั ัะดัะฐั ะฟัะพัะตััะพัะฐ
- ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฝะฐะณััะทะบะธ ะผะตะถะดั Core0 ะธ Core1
- ะะพะฝะธัะพัะธะฝะณ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะทะฐะดะฐั
- ะะฑัะฐะฑะพัะบะฐ ะฟัะธะพัะธัะตัะพะฒ

**ะััะธัะตะบัััะฐ ะทะฐะดะฐั:**

```
Core 0 (Protocol CPU):           Core 1 (Application CPU):
โโโ WebSocket Server Task        โโโ Video Stream Task (HIGH)
โโโ WiFi Event Handling          โโโ Camera Capture Loop
โโโ Serial Commands              โโโ Frame Processing
โโโ System Monitoring            โโโ Memory Management
```

### `/src/commands/command_handler.cpp` - Serial ะบะพะผะฐะฝะดั

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะะฑัะฐะฑะพัะบะฐ ะบะพะผะฐะฝะด ัะตัะตะท Serial ะฟะพัั
- ะะธะฐะณะฝะพััะธะบะฐ ะธ ะพัะปะฐะดะบะฐ ัะธััะตะผั
- ะะฝัะตัะฐะบัะธะฒะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต
- ะะพะฝะธัะพัะธะฝะณ ัะพััะพัะฝะธั

## ๐ ะะธะทะฝะตะฝะฝัะน ัะธะบะป ัะธััะตะผั

### 1. ะะฝะธัะธะฐะปะธะทะฐัะธั (setup)

```
1. Serial.begin(115200)
2. SystemManager::getInstance().init()
   โโโ Camera initialization
   โโโ WiFi AP start
   โโโ WebSocket server start
   โโโ Task creation (Core0 + Core1)
3. CommandHandler setup
4. "System ready" message
```

### 2. ะัะฝะพะฒะฝะพะน ัะธะบะป (loop)

```
1. SystemManager::update()
   โโโ Task monitoring
   โโโ Error checking
   โโโ Statistics update
2. CommandHandler::processCommands()
   โโโ Serial input processing
   โโโ Command execution
3. Minimal delay (100ฮผs)
```

### 3. ะะฐัะฐะปะปะตะปัะฝัะต ะทะฐะดะฐัะธ (FreeRTOS)

```
VideoStreamTask (Core1, Priority 2):
โโโ Camera frame capture
โโโ JPEG compression
โโโ Frame statistics
โโโ Memory management

WebSocketTask (Core0, Priority 1):
โโโ Client connection handling
โโโ Frame transmission
โโโ Connection monitoring
โโโ Protocol management
```

## ๐ ะะพัะพะบะธ ะดะฐะฝะฝัั

### ะะธะดะตะพ ะฟะพัะพะบ:

```
OV2640 Camera โ Frame Buffer โ JPEG Encoder โ WebSocket โ Client Browser
     โ             โ              โ              โ              โ
  Hardware     PSRAM Memory   Compression   Network TCP    Display
  20-30ms        <1ms          5-10ms       10-50ms       16ms
```

### ะฃะฟัะฐะฒะปัััะธะต ะดะฐะฝะฝัะต:

```
Serial Commands โ CommandHandler โ SystemManager โ Module Actions
Browser โ HTML Page โ WebSocket Server โ HTTP Request
```

## โก ะะฟัะธะผะธะทะฐัะธะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

### ะะฐะผััั:

- **PSRAM** ะดะปั ะฑััะตัะพะฒ ะบะฐะดัะพะฒ (8MB ะดะพัััะฟะฝะพ)
- **Heap** ะดะปั ะฝะตะฑะพะปััะธั ะพะฑัะตะบัะพะฒ ะธ ััะตะบะฐ
- **ะะฒะพะนะฝะฐั ะฑััะตัะธะทะฐัะธั** ะดะปั ะฟะปะฐะฒะฝะพะณะพ ะทะฐัะฒะฐัะฐ
- **ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ** ะฝะตะธัะฟะพะปัะทัะตะผัั ะฑััะตัะพะฒ

### ะกะตัั:

- **ะะฐัะธะฒะฝัะน WebSocket** ะฑะตะท ะฑะธะฑะปะธะพัะตะบ
- **ะะธะฝะฐัะฝะฐั ะฟะตัะตะดะฐัะฐ** JPEG ะฑะตะท ะบะพะดะธัะพะฒะฐะฝะธั
- **ะััััััะฒะธะต ะดะพะฟะพะปะฝะธัะตะปัะฝะพะน ะฑััะตัะธะทะฐัะธะธ**
- **TCP_NODELAY** ะดะปั ะฝะธะทะบะพะน ะทะฐะดะตัะถะบะธ

### ะัะพัะตััะพั:

- **Dual-core** ะธัะฟะพะปัะทะพะฒะฐะฝะธะต (Core0 + Core1)
- **ะัะธะพัะธัะตัั ะทะฐะดะฐั** ะดะปั ะบัะธัะธัะฝัั ะพะฟะตัะฐัะธะน
- **ะะธะฝะธะผะฐะปัะฝัะต ะทะฐะดะตัะถะบะธ** ะฒ ะพัะฝะพะฒะฝะพะผ ัะธะบะปะต
- **240MHz** ัะฐะบัะพะฒะฐั ัะฐััะพัะฐ

## ๐ง ะะฐัััะพะนะบะฐ ะธ ะบะพะฝัะธะณััะฐัะธั

### ะัะฝะพะฒะฝัะต ะฟะฐัะฐะผะตััั ะฒ `/include/ov2640.h`:

```cpp
constexpr uint8_t TARGET_FPS = 30;        // ะฆะตะปะตะฒะพะน FPS
constexpr uint8_t JPEG_QUALITY = 8;       // ะะฐัะตััะฒะพ (0-63)
constexpr framesize_t FRAME_SIZE = FRAMESIZE_QVGA; // ะะฐะทัะตัะตะฝะธะต
```

### WiFi ะฝะฐัััะพะนะบะธ ะฒ `/src/wifi/wifi_module.cpp`:

```cpp
wifi.init("ESP32-S3_Drone_30fps", "drone2024");
```

### WebSocket ะฝะฐัััะพะนะบะธ ะฒ `/include/websocket_server.h`:

```cpp
static const int MAX_CLIENTS = 3;         // ะะฐะบัะธะผัะผ ะบะปะธะตะฝัะพะฒ
uint16_t port = 8080;                     // ะะพัั ัะตัะฒะตัะฐ
```

## ๐จ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

### ะกััะฐัะตะณะธะธ ะฒะพัััะฐะฝะพะฒะปะตะฝะธั:

1. **Camera failure**: ะะฒัะพะฟะตัะตะทะฐะฟััะบ ะดัะฐะนะฒะตัะฐ ะบะฐะผะตัั
2. **WiFi disconnection**: ะะฒัะพะฒะพัััะฐะฝะพะฒะปะตะฝะธะต AP
3. **WebSocket errors**: ะะตัะตะฟะพะดะบะปััะตะฝะธะต ะบะปะธะตะฝัะพะฒ
4. **Memory exhaustion**: ะะฒัะพะพัะธััะบะฐ ะฑััะตัะพะฒ
5. **Task watchdog**: ะัะณะบะธะน ะฟะตัะตะทะฐะฟััะบ ะทะฐะดะฐั

### ะะพะณะธัะพะฒะฐะฝะธะต:

- **Serial output** ะดะปั ะพัะปะฐะดะบะธ (115200 baud)
- **ะฃัะพะฒะฝะธ ะปะพะณะพะฒ**: ERROR, WARN, INFO, DEBUG
- **ะกัะฐัะธััะธะบะฐ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ** ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- **Memory monitoring** ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ะฟะตัะตะฟะพะปะฝะตะฝะธั

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะดะธะฐะณะฝะพััะธะบะฐ

### Serial ะบะพะผะฐะฝะดั:

```bash
status     # ะะพะปะฝัะน ััะฐััั ะฒัะตั ะผะพะดัะปะตะน
memory     # ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ (Heap/PSRAM)
fps        # ะขะตะบััะฐั ัะฐััะพัะฐ ะบะฐะดัะพะฒ
clients    # ะะพะดะบะปััะตะฝะฝัะต WebSocket ะบะปะธะตะฝัั
wifi       # ะกัะฐััั WiFi ัะพะตะดะธะฝะตะฝะธั
restart    # ะะตัะตะทะฐะณััะทะบะฐ ัะธััะตะผั
help       # ะกะฟัะฐะฒะบะฐ ะฟะพ ะฒัะตะผ ะบะพะผะฐะฝะดะฐะผ
```

### ะะฒัะพะผะฐัะธัะตัะบะธะน ะผะพะฝะธัะพัะธะฝะณ:

- FPS tracking ะบะฐะถะดัั ัะตะบัะฝะดั
- Memory usage ะบะฐะถะดัะต 5 ัะตะบัะฝะด
- Connection health ะบะฐะถะดัะต 30 ัะตะบัะฝะด
- System uptime ะธ ััะฐัะธััะธะบะฐ ะฟะตัะตะทะฐะณััะทะพะบ

## ๐ฎ ะะปะฐะฝั ัะฐะทะฒะธัะธั

### ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:

- **ะะพะดะดะตัะถะบะฐ H.264** ะดะปั ะปัััะตะณะพ ัะถะฐัะธั
- **ะฃะฟัะฐะฒะปะตะฝะธะต ะผะพัะพัะฐะผะธ** ะดะปั ะดัะพะฝะฐ
- **ะขะตะปะตะผะตััะธั** (GPS, IMU, Battery)
- **ะะฐะฟะธัั ะฝะฐ SD ะบะฐััั**
- **OTA ะพะฑะฝะพะฒะปะตะฝะธั** ัะตัะตะท WiFi
- **ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต**

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ะผะพะดัะปะตะน:

1. ะกะพะทะดะฐัั ะบะปะฐัั ะฒ `/src/new_module/`
2. ะะพะฑะฐะฒะธัั ะทะฐะณะพะปะพะฒะพะบ ะฒ `/include/`
3. ะะฝัะตะณัะธัะพะฒะฐัั ะฒ `SystemManager`
4. ะะพะฑะฐะฒะธัั ะบะพะผะฐะฝะดั ะฒ `CommandHandler`
